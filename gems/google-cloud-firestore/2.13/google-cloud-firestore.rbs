# Write the type definition here!
module Google
  module Cloud
    module Firestore
      type filterable_value = Integer | Float | String | bool | Array[untyped] | Time | StringIO | Datastore::Key | Datastore::Entity
      type operator_options = "<" | "lt" | "<=" | "lte" | ">" | "gt" | ">=" | "gte" | "=" | "==" | "eq" | "eql" | "is" | "!=" | "array_contains" | "array-contains" | "include" | "include?" | "has" | "in" | "not_in" | "not-in" | "array_contains_any" | "array-contains-any"
      type field_key = FieldPath | String | Symbol

      class Client
        attr_accessor service: Service

        def self.new: (Service service) -> Client

        def project_id: () -> String

        def database_id: () -> String

        def path: () -> String

        def cols: (?real_time: Time?) ?{ (CollectionReference collection) -> untyped } -> Enumerator[CollectionReference, untyped]

        alias collections cols
        alias list_collections cols

        def col: (String collection_path) -> CollectionReference

        alias collection col

        def col_group: (String collection_id) -> CollectionGroup

        alias collection_group col_group

        def filter: (String | Symbol | FieldPath field, operator_options operator, filterable_value value) -> Filter

        def doc: (String document_path) -> DocumentReference

        def get_all: (String | DocumentReference | Array[String | DocumentReference] docs, ?field_mask: Array[String | FieldPath]?, ?real_time: Time?) -> Enumerator[DocumentSnapshot, untyped]
          | (String | DocumentReference | Array[String | DocumentReference] docs, ?field_mask: Array[String | FieldPath]?, ?real_time: Time?) { (DocumentSnapshot document) -> untyped } -> void

        alias get_docs get_all
        alias get_documents get_all
        alias find get_all

        def document_id: () -> FieldPath

        def transaction: (?max_retries: Integer?, ?commit_response: bool?) { (Transaction) -> untyped } -> untyped

        def read_only_transaction: (?real_time: Time?) { (Transaction) -> untyped } -> untyped
      end

      class Query
        type order_direction = :desc | :asc | "desc" | "asc"

        def select: (field_key | Array[field_key] fields) -> instance
        def all_dependents: () -> instance
        def direct_descendants: () -> instance

        def where: (Filter filter) -> instance
                 | (field_key? field, operator_options? operator, filterable_value? value) -> instance

        def order: (field_key? field, ?order_direction? direction) -> instance
        alias order_by order

        def offset: (Integer num) -> instance
        def limit: (Integer num) -> instance
        def limit_to_last: (Integer num) -> instance

        def start_at: ((DocumentSnapshot | untyped | Array[untyped]) values) -> instance
        def start_after: ((DocumentSnapshot | untyped | Array[untyped]) values) -> instance
        def end_before: ((DocumentSnapshot | untyped | Array[untyped]) values) -> instance
        def end_at: ((DocumentSnapshot | untyped | Array[untyped]) values) -> instance

        def get: (?real_time: Time?) -> Enumerator[DocumentSnapshot, untyped]
               | (?real_time: Time?) { (DocumentSnapshot document) -> untyped } -> void
        alias run get

        def listen: { (DocumentSnapshot snapshot) -> untyped } -> DocumentListener
        alias on_snapshot listen
      end

      class Service
      end

      class CollectionReferenceList
      end

      class CollectionReference < Query
        def collection_id: () -> String
        def collection_path: () -> String
        def doc: (String? document_path) -> DocumentReference
        def add: (Hash[untyped, untyped]? data) -> DocumentReference
      end

      class DocumentReference < Query
        attr_accessor client: Client

        def document_id: () -> String
        def document_path: () -> String

        def cols: (?real_time: Time?) ?{ (CollectionReference collection) -> untyped } -> Enumerator[CollectionReference, untyped]
        alias collections cols
        alias list_collections cols

        def col: (String collection_path) -> CollectionReference
        alias collection col

        def get: () -> DocumentSnapshot

        def listen: { (DocumentSnapshot snapshot) -> untyped } -> DocumentListener
        alias on_snapshot listen

        def create: (Hash[field_key, untyped] data) -> CommitResponse::WriteResult

        def set: (Hash[field_key, untyped] data, ?merge: (bool | FieldPath | String | Symbol)?) -> CommitResponse::WriteResult

        def update: (Hash[field_key, untyped] data, ?update_time: Time?) -> CommitResponse::WriteResult

        def delete: (?exists: bool?, ?update_time: Time?) -> CommitResponse::WriteResult
      end

      class CollectionGroup < Query
      end

      class FieldPath
        include Comparable

        def fields: () -> Array[String]
        def formatted_string: () -> String

        def self.document_id: () -> FieldPath
        def self.parse: (String dotted_string) -> FieldPath
      end

      class Filter
        def and: (Filter filter) -> instance
               | ((String | Symbol | FieldPath)? field, operator_options? operator, filterable_value? value) -> instance

        def or: (Filter filter) -> instance
              | ((String | Symbol | FieldPath)? field, operator_options? operator, filterable_value? value) -> instance
      end

      class DocumentSnapshot
      end

      class FieldValue
      end

      class Transaction
      end
    end

    module Datastore
      class Key
      end

      class Entity
      end
    end
  end

  module Auth
    module Credentials
    end
  end
end
